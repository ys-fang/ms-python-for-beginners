WEBVTT

00:00:04.340 --> 00:00:08.490
>> 讓我們來看看
如何使用"dotenv"

00:00:08.490 --> 00:00:12.510
作為一種管理
環境變數的解決方案

00:00:12.510 --> 00:00:13.875
在這一單元

00:00:13.875 --> 00:00:15.760
我會很快的演示

00:00:15.760 --> 00:00:17.970
如何在一個網站中

00:00:17.970 --> 00:00:20.625
添加環境變數

00:00:20.625 --> 00:00:23.180
並且部署到到Azure
這樣的雲端服務

00:00:23.180 --> 00:00:26.445
你可以看看在本地和在雲端

00:00:26.445 --> 00:00:30.345
分別要如何設置
但第一步先從安裝"dotenv"套件開始

00:00:30.345 --> 00:00:32.250
我已經設定好我的環境

00:00:32.250 --> 00:00:35.075
我創建了一個虛擬環境

00:00:35.075 --> 00:00:38.675
我們在之前的單元已經學過

00:00:38.675 --> 00:00:41.810
如何創建虛擬環境

00:00:41.810 --> 00:00:45.410
我在命令列啟用了

00:00:45.410 --> 00:00:47.345
這個虛擬環境

00:00:47.345 --> 00:00:49.640
然後我也我也設定了

00:00:49.640 --> 00:00:52.055
一個"requirements.txt"檔案

00:00:52.055 --> 00:00:54.665
而套件“dotenv"的正式名稱

00:00:54.665 --> 00:00:57.635
其實是"python-dotenv"

00:00:57.635 --> 00:01:00.420
所以我在"requirements.txt"中
寫了它的正式名稱

00:01:00.420 --> 00:01:03.350
然後安裝它

00:01:03.350 --> 00:01:07.269
用我們已經學過的"pip"

00:01:07.269 --> 00:01:11.485
"pip install -r requirements.txt"

00:01:11.485 --> 00:01:14.070
這樣它就會安裝"dotenv"套件

00:01:14.070 --> 00:01:16.075
接下來我要創建一個新的文字檔

00:01:16.075 --> 00:01:18.230
取名".env"

00:01:18.230 --> 00:01:21.740
".env"檔案內容就是

00:01:21.740 --> 00:01:24.830
一對一對的鍵值對

00:01:24.830 --> 00:01:28.175
環境變數的鍵值對

00:01:28.175 --> 00:01:29.750
它可能是像這樣的東西

00:01:29.750 --> 00:01:33.035
也許是密碼或者

00:01:33.035 --> 00:01:37.025
別的什麼東西

00:01:37.025 --> 00:01:39.500
那些你不想讓

00:01:39.500 --> 00:01:41.690
所有人知道的東西

00:01:41.690 --> 00:01:43.340
在等號後面其實可以放任何字元

00:01:43.340 --> 00:01:45.155
但小心處理引號是個好習慣

00:01:45.155 --> 00:01:48.915
所以我們設定了"PASSWORD"

00:01:48.915 --> 00:01:51.375
另外要提醒

00:01:51.375 --> 00:01:54.030
有在使用git的人

00:01:55.490 --> 00:01:57.915
記得要在".gitignore"中

00:01:57.915 --> 00:02:01.805
把".env"列進去

00:02:01.805 --> 00:02:04.760
這樣才不會意外的把

00:02:04.760 --> 00:02:08.240
".env"這個檔案也發佈出去

00:02:08.240 --> 00:02:10.325
如果把".env"發佈出去
那就跟把密碼

00:02:10.325 --> 00:02:12.350
寫在程式碼中是一樣的

00:02:12.350 --> 00:02:14.570
再強調一次

00:02:14.570 --> 00:02:16.345
絕對不要這樣做

00:02:16.345 --> 00:02:18.585
好，讓我們繼續

00:02:18.585 --> 00:02:20.250
我已經設定好".env"

00:02:20.250 --> 00:02:22.215
讓我們開始寫主程式

00:02:22.215 --> 00:02:24.890
開啟"app.py"

00:02:24.890 --> 00:02:28.610
添加dotenv的相應程式碼

00:02:28.610 --> 00:02:38.505
"from dotenv import load_dotenv"

00:02:38.505 --> 00:02:42.590
然後執行
"load_dotenv()"函數

00:02:42.590 --> 00:02:45.425
如果你的".env"檔案
位於其他資料夾

00:02:45.425 --> 00:02:47.435
你可以在參數指定檔案路徑

00:02:47.435 --> 00:02:51.140
省略參數的話

00:02:51.140 --> 00:02:53.245
預設就是從當前的資料夾
找".env"檔案

00:02:53.245 --> 00:02:56.640
所以把".env"跟主程式
放在同一個資料夾是最簡單的做法

00:02:56.640 --> 00:03:00.060
但基於安全考量
你也可以放在別的資料夾

00:03:00.060 --> 00:03:03.884
"import os"

00:03:03.884 --> 00:03:11.775
password = os.getenv('PASSWORD')

00:03:11.775 --> 00:03:17.850
然後
print(password)

00:03:17.850 --> 00:03:19.880
順便說一下
這裡出現綠色毛毛蟲底線的原因

00:03:19.880 --> 00:03:23.270
這裡是因為我開啟了
拼字檢查功能

00:03:23.270 --> 00:03:24.680
任何人

00:03:24.680 --> 00:03:26.630
可能都跟我一樣

00:03:26.630 --> 00:03:28.040
會常常打錯字

00:03:28.040 --> 00:03:30.050
所以開啟拼字檢查
可以讓綠色毛毛蟲來提醒我

00:03:30.050 --> 00:03:35.270
若想要關掉這個提醒
只要把這個詞加到字典中

00:03:35.270 --> 00:03:36.590
這樣綠色毛毛蟲就會不見

00:03:36.590 --> 00:03:38.810
好，我們繼續

00:03:38.810 --> 00:03:40.300
所以我的程式碼就是這樣

00:03:40.300 --> 00:03:42.380
取得"PASSWORD"
然後輸出到螢幕

00:03:42.380 --> 00:03:45.260
讓我存檔
然後執行

00:03:45.260 --> 00:03:48.860
"python app.py"

00:03:48.860 --> 00:03:53.990
瞧，螢幕上出現了
"Don_t share this value"

00:03:53.990 --> 00:03:57.080
所以，使用"dotenv"是
存放敏感資訊的

00:03:57.080 --> 00:04:01.355
一個很方便的小技巧

00:04:01.355 --> 00:04:02.570
包括你的資料庫連接字串等等資訊

00:04:02.570 --> 00:04:06.799
都可以這樣用

00:04:06.799 --> 00:04:09.710
更重要的就是
不要把敏感資訊寫死在程式碼中

00:04:09.710 --> 00:04:12.700
更不要公開分享出去

00:04:12.700 --> 00:04:16.400
現在，讓我們來看看在一個

00:04:16.400 --> 00:04:20.375
已經部署到Azure的Web應用程式中
如何處理環境變數

00:04:20.375 --> 00:04:22.850
我打開網頁"portal.azure.com"

00:04:22.850 --> 00:04:26.060
在"App Services"分類下

00:04:26.060 --> 00:04:29.030
我之前已經先
創建了一個Web App

00:04:29.030 --> 00:04:31.985
我命名為"geektrainertesting"

00:04:31.985 --> 00:04:33.805
我打開它，然後找到

00:04:33.805 --> 00:04:39.380
"Configuration"

00:04:39.380 --> 00:04:42.275
這是我要設定

00:04:42.275 --> 00:04:44.900
環境變數的地方

00:04:44.900 --> 00:04:48.100
你會注意到右手邊

00:04:48.100 --> 00:04:50.260
是我的應用程式設定

00:04:50.260 --> 00:04:54.130
應用程式設定也是
簡單的鍵值對

00:04:54.130 --> 00:04:57.730
你會發現
這裡已經有存在一些設定

00:04:57.730 --> 00:05:00.220
一樣有"Name"和"Value"欄位

00:05:00.220 --> 00:05:05.905
而這些設定在這裡
就不會意外洩漏出去

00:05:05.905 --> 00:05:10.450
現在我可以去新增
我的應用程式設定

00:05:10.450 --> 00:05:12.505
"SAMPLE"

00:05:12.505 --> 00:05:15.349
"This is a sample value"

00:05:15.349 --> 00:05:17.190
然後按一下"更新"按鈕

00:05:17.190 --> 00:05:18.515
就像這樣

00:05:18.515 --> 00:05:22.885
這樣我就幫我的Web App
新增了一個的應用程式設定

00:05:22.885 --> 00:05:25.315
那麼我要怎麼在程式中
取用到這個設定呢？

00:05:25.315 --> 00:05:27.255
很妙的地方就在這裡

00:05:27.255 --> 00:05:30.200
從Azure中取得

00:05:30.200 --> 00:05:33.185
應用程式設定的方法

00:05:33.185 --> 00:05:36.350
仍然是"os.getenv()"

00:05:36.350 --> 00:05:39.605
正確指定參數就能取得

00:05:39.605 --> 00:05:41.900
這裡要特別強調

00:05:41.900 --> 00:05:44.450
我們之前寫的
使用"dotenv"的程式碼

00:05:44.450 --> 00:05:48.290
可以完全不用修改

00:05:48.290 --> 00:05:51.245
放上雲端也都沒問題

00:05:51.245 --> 00:05:55.310
所以我不需要特別為了
本地開發寫一段程式碼

00:05:55.310 --> 00:05:57.860
為了佈署到雲端
寫另一段程式碼

00:05:57.860 --> 00:06:00.140
我只要寫一次

00:06:00.140 --> 00:06:02.030
然後本地端和雲端都適用

00:06:02.030 --> 00:06:07.555
重要的是說三次
千萬不要把".env"檔案公開出去

00:06:07.555 --> 00:06:10.260
好的，這就是如何使用"dotenv"

00:06:10.260 --> 00:06:12.735
來管理這些金鑰和
各種設定值

00:06:12.735 --> 00:06:16.520
以及如何在雲端的
App Services中設定

00:06:16.520 --> 00:06:19.470
Web App的應用程式設定


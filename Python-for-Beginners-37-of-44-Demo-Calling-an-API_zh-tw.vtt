WEBVTT

00:00:04.100 --> 00:00:06.900
>> 好的。讓我們實際

00:00:06.900 --> 00:00:10.200
動手寫一些程式

00:00:10.200 --> 00:00:11.685
來呼叫別人寫好的API

00:00:11.685 --> 00:00:15.075
這是我們在程式中
經常做的事

00:00:15.075 --> 00:00:16.620
也許是同一間公司裡
別人寫的程式

00:00:16.620 --> 00:00:18.010
存放在伺服器
作為Web Service

00:00:18.010 --> 00:00:19.170
或者去呼叫

00:00:19.170 --> 00:00:21.570
別間公司寫的

00:00:21.570 --> 00:00:23.040
但開放給我們使用

00:00:23.040 --> 00:00:25.680
好用的Web Service

00:00:25.680 --> 00:00:27.855
在這個範例中，我想到呼叫的

00:00:27.855 --> 00:00:31.290
"Analyze Image"
是微軟Auzre的認知服務之一

00:00:31.290 --> 00:00:33.510
所以如果我查看說明文件

00:00:33.510 --> 00:00:35.280
記住

00:00:35.280 --> 00:00:37.455
永遠先上網搜尋說明文件

00:00:37.455 --> 00:00:39.510
文件告訴你首先要創建

00:00:39.510 --> 00:00:42.105
一個Azure資源

00:00:42.105 --> 00:00:44.715
之後才可以呼叫它

00:00:44.715 --> 00:00:47.855
要創建一個Azure資源

00:00:47.855 --> 00:00:50.360
意味著我需要一個Azure帳戶

00:00:50.360 --> 00:00:52.400
說明文件也告訴你如何

00:00:52.400 --> 00:00:54.650
創建你免費的帳戶

00:00:54.650 --> 00:00:57.590
並創建
認知服務資源

00:00:57.590 --> 00:00:59.480
假設我已經擁有Azure帳戶

00:00:59.480 --> 00:01:02.960
我也已經登入
portal.azure.com

00:01:02.960 --> 00:01:04.835
我開啟了Azure的首頁

00:01:04.835 --> 00:01:06.890
假設我知道我要創建甚麼

00:01:06.890 --> 00:01:09.725
那找到一種資源
最簡單的方法

00:01:09.725 --> 00:01:12.265
就是直接輸入然後搜尋

00:01:12.265 --> 00:01:15.570
例如我現在要創建的

00:01:15.570 --> 00:01:20.025
"Analyze Image"是

00:01:20.025 --> 00:01:22.735
屬於電腦視覺API

00:01:22.735 --> 00:01:25.645
我只要在
portal.azure.com

00:01:25.645 --> 00:01:28.520
搜索框中輸入

00:01:28.520 --> 00:01:32.300
"Computer Vision"

00:01:32.300 --> 00:01:35.090
你就會找到

00:01:35.090 --> 00:01:36.440
比從目錄和子目錄中

00:01:36.440 --> 00:01:38.435
找尋來得快

00:01:38.435 --> 00:01:41.460
我點擊
"Computer Vision"

00:01:41.460 --> 00:01:44.200
"哦，你要創建
電腦視覺API？"

00:01:44.200 --> 00:01:45.410
是的，我感謝你

00:01:45.410 --> 00:01:48.590
這就是得到金鑰和
API的網址的地方

00:01:48.590 --> 00:01:50.630
讓我們給它一個名字

00:01:50.630 --> 00:01:57.805
"pythonimageanalyzer"

00:01:57.805 --> 00:02:00.690
我將編寫Python程式碼

00:02:00.690 --> 00:02:01.730
會上傳一個圖片

00:02:01.730 --> 00:02:03.335
然後它會分析我的圖片

00:02:03.335 --> 00:02:05.420
你必須有
微軟Azure的訂閱帳號

00:02:05.420 --> 00:02:08.405
我選擇了一個訂閱帳號

00:02:08.405 --> 00:02:10.880
然後API網址

00:02:10.880 --> 00:02:13.520
取決於地理位置

00:02:13.520 --> 00:02:16.940
當你創建資源時

00:02:16.940 --> 00:02:20.390
你可以選擇要
儲存在哪一個資料中心

00:02:20.390 --> 00:02:22.340
你可以挑一個離你比較近的位置

00:02:22.340 --> 00:02:25.080
但要注意不同的資料中心
會有不同的訂價

00:02:25.080 --> 00:02:27.890
我在加拿大

00:02:27.890 --> 00:02:29.830
所以選擇美國東部

00:02:29.830 --> 00:02:31.450
然後是價格等級

00:02:31.450 --> 00:02:35.760
你會發現有一個免費等級
F0是免費版本

00:02:35.760 --> 00:02:37.200
我們現在只是做個示範

00:02:37.200 --> 00:02:38.655
所以免費等級就夠了

00:02:38.655 --> 00:02:40.640
當你想嘗試看看

00:02:40.640 --> 00:02:41.975
選反費等級就好

00:02:41.975 --> 00:02:44.000
等到你要正式上線

00:02:44.000 --> 00:02:47.005
在選擇付費等級

00:02:47.005 --> 00:02:48.840
然後是資源組

00:02:48.840 --> 00:02:50.470
資源組像一個資料夾

00:02:50.470 --> 00:02:54.290
把你的東西集中放在一起

00:02:54.290 --> 00:02:56.090
所以當你創建
多個資源

00:02:56.090 --> 00:02:57.980
多種資源時

00:02:57.980 --> 00:02:59.600
你可以把它們放進去
同一個資源組

00:02:59.600 --> 00:03:02.600
這樣你之後要刪除或修改它們時

00:03:02.600 --> 00:03:03.985
會比較方便

00:03:03.985 --> 00:03:09.635
因此讓我們創建一個新的
資源組稱為"rgpythonfun"

00:03:09.635 --> 00:03:11.285
之後如果我需要
在同一個專案

00:03:11.285 --> 00:03:12.710
創建相關的資源

00:03:12.710 --> 00:03:14.615
我會把它放在
同一個資源組中

00:03:14.615 --> 00:03:16.865
像專案資料夾一樣的概念

00:03:16.865 --> 00:03:18.805
如果我在這裡按下"創建"

00:03:18.805 --> 00:03:20.400
它就會創建

00:03:20.400 --> 00:03:22.005
一個"Computer Vision"資源

00:03:22.005 --> 00:03:23.979
但為了更順利的做演示

00:03:23.979 --> 00:03:25.730
我已經創建了
一個資源

00:03:25.730 --> 00:03:28.850
創建完成後

00:03:28.850 --> 00:03:32.510
我就可以在

00:03:32.510 --> 00:03:33.650
"所有資源"

00:03:33.650 --> 00:03:35.315
裡面

00:03:35.315 --> 00:03:37.740
看到

00:03:40.460 --> 00:03:45.275
我們

00:03:45.275 --> 00:03:47.640
創建好的資源

00:03:47.640 --> 00:03:49.625
我點擊"概述"頁面

00:03:49.625 --> 00:03:52.835
這是最重要的頁面

00:03:52.835 --> 00:03:54.980
因為

00:03:54.980 --> 00:03:57.455
這個頁面

00:03:57.455 --> 00:04:00.640
會告訴我
呼叫的網址

00:04:00.640 --> 00:04:03.520
以及金鑰

00:04:03.520 --> 00:04:06.595
這是呼叫這個服務
絕對必要得兩樣資訊

00:04:06.595 --> 00:04:09.785
所以在這裡
"Endpoint"就是我要呼叫的網址

00:04:09.785 --> 00:04:11.835
我剛才選擇了美國東部

00:04:11.835 --> 00:04:13.605
所以它是
eastus.api開頭

00:04:13.605 --> 00:04:16.140
這個網址

00:04:16.140 --> 00:04:18.070
其實也寫在說明文件上

00:04:18.070 --> 00:04:21.815
就看你要把服務放在哪裡的伺服器

00:04:21.815 --> 00:04:24.010
而金鑰管理在這邊

00:04:24.010 --> 00:04:26.140
如果我點擊

00:04:26.140 --> 00:04:28.060
"顯示存取金鑰"

00:04:28.060 --> 00:04:30.640
它就會顯示金鑰

00:04:30.640 --> 00:04:32.295
這裡有兩個不同的金鑰

00:04:32.295 --> 00:04:33.810
不管用哪一個都可以

00:04:33.810 --> 00:04:35.350
我可以複製它

00:04:35.350 --> 00:04:37.430
當程式中需要金鑰的時候

00:04:37.430 --> 00:04:40.235
貼到我的程式中

00:04:40.235 --> 00:04:41.840
好的。所以現在

00:04:41.840 --> 00:04:44.180
我有一個Web Service
已經準備被呼叫

00:04:44.180 --> 00:04:46.160
現在我要在
我的Python程式中

00:04:46.160 --> 00:04:48.725
實際上呼叫它看看

00:04:48.725 --> 00:04:51.290
我已經寫好

00:04:51.290 --> 00:04:52.610
一些程式碼

00:04:52.610 --> 00:04:53.795
我會一行一行解釋

00:04:53.795 --> 00:04:55.700
這些程式碼放在GitHub存儲庫中

00:04:55.700 --> 00:04:57.995
所以你隨時都可以自己

00:04:57.995 --> 00:04:59.150
下載下來玩看看

00:04:59.150 --> 00:05:00.935
但你需要先創建

00:05:00.935 --> 00:05:03.545
你自己的服務

00:05:03.545 --> 00:05:06.005
這裡有一些熟悉的語法

00:05:06.005 --> 00:05:08.530
"import requests"

00:05:08.530 --> 00:05:12.355
這個函式庫讓Python
更容易透過HTTP呼叫API

00:05:12.355 --> 00:05:14.460
另外還要
"import json"

00:05:14.460 --> 00:05:17.180
我們會在下一單元
詳細介紹JSON

00:05:17.180 --> 00:05:19.220
目前你只需要知道

00:05:19.220 --> 00:05:21.530
伺服器返回的資料

00:05:21.530 --> 00:05:23.735
格式是JSON

00:05:23.735 --> 00:05:26.915
所以我需要json這個套件
來處理返回的資料

00:05:26.915 --> 00:05:30.125
我已經複製並貼上
我的訂閱金鑰

00:05:30.125 --> 00:05:31.805
這樣Azure才知道我是誰

00:05:31.805 --> 00:05:35.555
以及是否有權
呼叫這個Web Service

00:05:35.555 --> 00:05:37.100
然後這是
Web Service的網址

00:05:37.100 --> 00:05:38.960
我這裡使用上一次
創建的資源

00:05:38.960 --> 00:05:41.315
所以跟剛才創建的資源
有不同的網址

00:05:41.315 --> 00:05:44.755
而網址光是這樣

00:05:44.755 --> 00:05:47.300
是不夠的

00:05:47.300 --> 00:05:49.775
還必須指定是
哪一個Web Service

00:05:49.775 --> 00:05:53.405
因為這個網址只指到
"Computer Vision API"

00:05:53.405 --> 00:05:54.695
我需要指定函數名稱

00:05:54.695 --> 00:05:56.390
也就是"Computer Vision API"中的

00:05:56.390 --> 00:05:58.785
"analyze"函數

00:05:58.785 --> 00:06:01.065
我怎麼知道的？

00:06:01.065 --> 00:06:04.820
當然是因為看了說明文件

00:06:04.820 --> 00:06:06.440
回到API說明網頁

00:06:06.440 --> 00:06:07.675
查看呼叫某個Web Service

00:06:07.675 --> 00:06:09.660
需要的"Request URL"格式

00:06:09.660 --> 00:06:11.280
你會看到它寫"analyze"

00:06:11.280 --> 00:06:12.824
所以這是網址的格式

00:06:12.824 --> 00:06:15.080
其中唯一能改變的
是伺服器名稱

00:06:15.080 --> 00:06:17.240
"analyze"是方法的名稱

00:06:17.240 --> 00:06:20.640
所以，所以資訊都在說明文件中

00:06:21.050 --> 00:06:23.250
讓我們回到我們的程式碼

00:06:23.250 --> 00:06:25.850
繼續我下看

00:06:25.850 --> 00:06:28.190
現在網址已經包含了

00:06:28.190 --> 00:06:30.815
伺服器的位置和函數名稱

00:06:30.815 --> 00:06:33.050
接下來還有幾個函數需要的參數

00:06:33.050 --> 00:06:35.500
任何時候你呼叫一個函數

00:06:35.500 --> 00:06:37.655
你必須傳給它正確的參數

00:06:37.655 --> 00:06:39.785
所以我需要傳甚麼參數呢？

00:06:39.785 --> 00:06:44.725
是的，又要回來看說明文件
"visualFeatures"

00:06:44.725 --> 00:06:48.185
這是字串型別
註明要返回的視覺特徵類型

00:06:48.185 --> 00:06:50.885
包含多個值
用逗號分隔開

00:06:50.885 --> 00:06:52.520
有效值包括這些

00:06:52.520 --> 00:06:54.800
因此，這基本上是說

00:06:54.800 --> 00:06:57.740
當我用這個函數來分析圖像，

00:06:57.740 --> 00:06:59.760
我必須告訴它
我想要得到那些資訊

00:06:59.760 --> 00:07:02.045
我想知道圖片中有甚麼顏色嗎？

00:07:02.045 --> 00:07:03.455
圖片的描述？

00:07:03.455 --> 00:07:05.300
圖片中有出現人臉嗎？

00:07:05.300 --> 00:07:06.725
圖片中出現什麼物體？

00:07:06.725 --> 00:07:08.420
還是取得圖片的標籤？

00:07:08.420 --> 00:07:13.340
我這裡想取得
敘述和顏色

00:07:13.340 --> 00:07:15.875
你可以自己試看看

00:07:15.875 --> 00:07:17.900
選擇取得其他的資訊

00:07:17.900 --> 00:07:20.930
然後我指定要
返回英文的資訊

00:07:20.930 --> 00:07:22.760
所以如果照片裡有熊

00:07:22.760 --> 00:07:25.045
它會返回"bear"給我

00:07:25.045 --> 00:07:28.245
好，這些是參數的部分

00:07:28.245 --> 00:07:30.190
在這個範例中

00:07:30.190 --> 00:07:33.680
我要上傳圖片
讓Web Service分析

00:07:33.680 --> 00:07:35.310
這個圖片在一個子資料夾

00:07:35.310 --> 00:07:36.670
在我的電腦上

00:07:36.670 --> 00:07:39.110
但我也已經把它
上傳到GitHub了

00:07:39.110 --> 00:07:40.865
檔名是：PolarBear.jpg

00:07:40.865 --> 00:07:42.200
所以這是一張北極熊的照片

00:07:42.200 --> 00:07:45.455
"open"這個函數

00:07:45.455 --> 00:07:47.765
會讀取檔案

00:07:47.765 --> 00:07:49.310
並把內容存到一個變數中

00:07:49.310 --> 00:07:50.465
VS Code可以查看

00:07:50.465 --> 00:07:52.340
函數的說明

00:07:52.340 --> 00:07:54.110
它說明了

00:07:54.110 --> 00:07:55.895
"open"函數的用法

00:07:55.895 --> 00:07:59.790
這樣我們就能把圖片
上傳給雲端Web Service

00:07:59.990 --> 00:08:04.340
接下來還要處理
"HTTP headers"

00:08:04.340 --> 00:08:06.050
這也是必須要指定的

00:08:06.050 --> 00:08:08.105
在這個範例中
我要指定那些header呢？

00:08:08.105 --> 00:08:11.135
再回頭來查說明文件

00:08:11.135 --> 00:08:13.385
我需要指定"Content-Type"

00:08:13.385 --> 00:08:17.220
"Content-Type"有三個選項

00:08:17.220 --> 00:08:19.470
"json", "octet-stream",
"form-data"

00:08:19.470 --> 00:08:21.615
這三種選項

00:08:21.615 --> 00:08:23.900
這裡基本上取決於
我們提供給Web Service的

00:08:23.900 --> 00:08:26.830
是圖片的網址？

00:08:26.830 --> 00:08:29.055
還是直接上傳圖片？

00:08:29.055 --> 00:08:32.415
因為我們直接上傳圖片

00:08:32.415 --> 00:08:37.060
所以這裡要選："octet-stream"

00:08:37.060 --> 00:08:40.655
然後金鑰就是

00:08:40.655 --> 00:08:42.230
之前從Azure Portal
取得的那個金鑰

00:08:42.230 --> 00:08:44.315
順便說一下

00:08:44.315 --> 00:08:46.850
這種把金鑰直接明碼
寫在程式中的做法

00:08:46.850 --> 00:08:48.470
不是最佳做法

00:08:48.470 --> 00:08:51.605
我現在這樣做
只是為了讓你容易理解和自行嘗試

00:08:51.605 --> 00:08:53.645
但如果你用了畫面上的這個金鑰

00:08:53.645 --> 00:08:55.835
這個屬於我蘇珊的金鑰

00:08:55.835 --> 00:08:57.035
來呼叫Web Service

00:08:57.035 --> 00:08:59.735
那Azure會跟我收錢

00:08:59.735 --> 00:09:01.655
我當然不是我想要的方式

00:09:01.655 --> 00:09:04.055
這就像是我把我的房子鑰匙給你

00:09:04.055 --> 00:09:06.005
你就可以到我家來並打開門

00:09:06.005 --> 00:09:07.820
如果我給你我的API金鑰

00:09:07.820 --> 00:09:10.775
你可以使用這個API
並假裝你是我

00:09:10.775 --> 00:09:12.830
所以我不想那樣做。
我想保護它

00:09:12.830 --> 00:09:15.080
克里斯多夫會在之後的課程

00:09:15.080 --> 00:09:17.525
解釋正確儲存API金鑰的方法

00:09:17.525 --> 00:09:20.075
一定要看喔～

00:09:20.075 --> 00:09:22.925
所以現在我已經有
所有需要的資訊

00:09:22.925 --> 00:09:24.170
我有網址

00:09:24.170 --> 00:09:25.430
我有HTTP headers

00:09:25.430 --> 00:09:26.660
我有參數

00:09:26.660 --> 00:09:30.660
現在我已經準備好去

00:09:30.660 --> 00:09:32.700
呼叫某個位於雲端資料中心的
Web Service

00:09:32.700 --> 00:09:35.685
所以我呼叫"requests.post()"

00:09:35.685 --> 00:09:37.650
我把網址傳給它

00:09:37.650 --> 00:09:39.120
我傳給它headers

00:09:39.120 --> 00:09:40.320
我傳給它參數

00:09:40.320 --> 00:09:43.345
以及圖片

00:09:43.345 --> 00:09:45.260
這裡還有一行額外的程式碼

00:09:45.260 --> 00:09:47.120
我覺得真的很有用

00:09:47.120 --> 00:09:50.570
這行的意思是說

00:09:50.570 --> 00:09:52.040
如果呼叫的Web Service

00:09:52.040 --> 00:09:53.735
回傳的狀態碼有異常
(通常是4xx或5xx)

00:09:53.735 --> 00:09:55.220
就在這裡拋出異常

00:09:55.220 --> 00:09:57.665
所以我可以處理這個狀況
就像處理其他的Python例外

00:09:57.665 --> 00:10:00.290
使用try, except, finally的方式

00:10:00.290 --> 00:10:03.110
就像我們之前
在錯誤處理章節學到的

00:10:03.110 --> 00:10:04.520
程式中主動拋出例外狀況

00:10:04.520 --> 00:10:06.570
然後根據不同狀況

00:10:06.570 --> 00:10:08.840
適當的處理

00:10:08.840 --> 00:10:10.970
然後，我最後要做的是

00:10:10.970 --> 00:10:12.665
在螢幕上顯示結果

00:10:12.665 --> 00:10:14.540
現在不用擔心
看不懂這兩行程式碼

00:10:14.540 --> 00:10:16.715
我們很快會介紹JSON

00:10:16.715 --> 00:10:21.215
但如果我運氣不錯
上面的程式碼都沒寫錯

00:10:21.215 --> 00:10:27.270
那麼我執行：
"python call_api.py"

00:10:27.280 --> 00:10:30.680
就能看到回傳的結果

00:10:30.680 --> 00:10:33.485
連結雲端的某台伺服器
檢查我的金鑰

00:10:33.485 --> 00:10:35.960
確保我有存取權
上傳圖片

00:10:35.960 --> 00:10:37.535
然後回傳

00:10:37.535 --> 00:10:40.025
關於該圖片的資訊

00:10:40.025 --> 00:10:42.125
哇。成功了

00:10:42.125 --> 00:10:43.775
我們成功的呼叫了
Web Service

00:10:43.775 --> 00:10:45.800
但我們要如何理解
這些傳回來的資訊？

00:10:45.800 --> 00:10:48.750
我們會在下一單元
介紹JSON

